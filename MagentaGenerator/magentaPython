import subprocess
import json
import os

import sys
sys.path.append('./NoteSeqUtils/')

import noteseqConverter as nc

def generate_melodies(n_melodies):

    outputs = []

    for i in range(n_melodies):
        # Llama al script JavaScript desde Python
        process = subprocess.Popen(['node', os.getcwd() + '\MagentaGenerator\magentaTests.js'], stdout=subprocess.PIPE)
        
        # Captura la salida del proceso (la secuencia de notas generada)
        output, _ = process.communicate()
        
        # Decodifica la salida JSON que contiene la secuencia de notas generada
        melody_data = json.loads(output.decode('utf-8'))

        out = "./midi/magenta_melody_" + str(i) + ".mid"
        nc.save_to_midi(nc.json_to_noteSeq(melody_data), out)
        outputs.append(out)
        print(f"Saved midi to {out}")

    return outputs

generate_melodies(2)